/**
 * slide-zilla
 * 
 * Full page slides scroller that works on all screen sizes
 * 
 * @author Jelle Kralt <jellekralt@codezilla.nl>
 * @version v0.1.1
 * @license MIT
 */
!function(t,s,i){function e(s,i){this.element=s,this.$element=t(s),this.slides=[],this.options=t.extend({},o,i),this.init()}var n="slidezilla",o={classes:{container:"sz-slides",slide:"sz-slide",slideSticky:"sz-slide-sticky",stateExcluded:"sz-slide-excluded",navigation:"sz-nav",navigationVisible:"sz-nav-visible",navigationHandle:"sz-nav-handle",navigationHandleOpen:"sz-nav-handle-open",navigationItems:"sz-nav-items"}};e.prototype.init=function(){this.slides=this._loadElements(),this.nav=this._loadNavigation(),this._loadClasses(),this.lastScrollTop=0,this._addEventListeners(),this._determineOffsets()},e.prototype._loadElements=function(){var s=this,i=[],e=0;return t("section",s.$element).each(function(n){var o=t(this).css("z-index",n+1),a=o.hasClass(s.options.classes.stateExcluded);if(!a){var l={_ignoreHashChange:!1,id:e,panel:o,active:!1};e++,i.push(l)}}),i},e.prototype._loadNavigation=function(){var s=this,i=t(this.options.navigation,s.$element),e=null;return i.length&&(e={container:i,handle:t("."+this.options.classes.navigationHandle,i),items:t("."+this.options.classes.navigationItems,i),links:[]},t("a",i).each(function(){var s,i=t(this);try{s=t(i.attr("href"))}catch(n){}s&&s.length&&e.links.push(t(this))})),e},e.prototype._loadClasses=function(){this.$element.addClass(this.options.classes.container),this.nav&&this.nav.container.addClass(this.options.classes.navigation);for(var t=0;t<this.slides.length;t++)this.slides[t].panel.addClass(this.options.classes.slide)},e.prototype._addEventListeners=function(){var i,e=this;if(t(s).on("scroll",this._throttle(e._handleScroll)),t(s).on("resize",this._throttle(e._determineOffsets)),this.nav){i=function(t){e._goTo(t,this)},this.nav.handle.on("click",function(){e._toggleNavItems()});for(var n=0;n<this.nav.links.length;n++)this.nav.links[n].on("click",i)}},e.prototype._removeEventListeners=function(){var i=this;if(t(s).off("scroll",this._throttle(i._handleScroll)),t(s).off("resize",this._throttle(i._determineOffsets)),this.nav){this.nav.handle.off("click");for(var e=0;e<this.nav.links.length;e++)this.nav.links[e].off("click")}},e.prototype._handleScroll=function(){var i=t(s).scrollTop(),e=i+t(s).height();this._determineActiveSlide(i,e),this.nav&&this.nav.handle.is(":hidden")&&this._toggleNavbar(i<this.lastScrollTop&&i>=0),this.lastScrollTop=i},e.prototype._goTo=function(s,i){var e=t(i).attr("href"),n=t(e)[0].offsetTop;s.preventDefault(),this.nav&&this.nav.handle.is(":visible")&&(n-=this.nav.handle.outerHeight()),this._toggleNavItems(!1),t("html, body").animate({scrollTop:n},800,"swing")},e.prototype._isSlideTooBig=function(i){return i.panel.outerHeight()>t(s).height()},e.prototype._determineActiveSlide=function(t,s){var i=this;this.slides.forEach(function(e,n){var o=i._isSlideTooBig(e),a=parseInt(e.panel.attr("data-offset"));o&&e.panel[0].offsetTop+e.panel.height()<=s&&a+e.panel.height()<s?i._setSticky(e,!0):!o&&e.panel[0].offsetTop<=t&&t>a?i._setSticky(e,!0):o&&a+e.panel.height()>s?i._setSticky(e,!1):!o&&a>t&&i._setSticky(e,!1)})},e.prototype._setSticky=function(t,s){var i,e=this._isSlideTooBig(t);s?(i=t.panel.css("top"),e?t.panel.addClass(this.options.classes.slideSticky).css({top:"auto",bottom:0}):t.panel.addClass(this.options.classes.slideSticky).css({top:0,bottom:"auto"})):(i=t.panel.attr("data-offset"),t.panel.removeClass(this.options.classes.slideSticky).css({top:i+"px",bottom:"auto"}))},e.prototype._throttle=function(t,s){var i=this,e=!1;return function(n){e||(t.call(i,n),e=!0,setTimeout(function(){e=!1},s))}},e.prototype._toggleNavbar=function(t){this.nav.container.toggleClass(this.options.classes.navigationVisible,t)},e.prototype._toggleNavItems=function(t){this.nav.handle.toggleClass(this.options.classes.navigationHandleOpen,t)},e.prototype._determineOffsets=function(){var t=this,s=0;t.slides.forEach(function(t){t.panel.css({top:s}),t.panel.attr({"data-offset":s}),s+=t.panel.height()})},e.prototype.refresh=function(){this._removeEventListeners(),this.init()},e.prototype.option=function(t,s){return s&&(this.options[t]=s),this.options[t]},t.fn[n]=function(s){var o=arguments;return s===i||"object"==typeof s?this.each(function(){t.data(this,n)||t.data(this,n,new e(this,s))}):"string"==typeof s&&"_"!==s[0]&&"init"!==s?this.each(function(){var i=t.data(this,n);i instanceof e&&"function"==typeof i[s]&&i[s].apply(i,Array.prototype.slice.call(o,1)),"destroy"===s&&t.data(this,n,null)}):void 0}}(jQuery,window);